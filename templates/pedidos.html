<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Pedidos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='pedidos.css') }}">
</head>
<body>
    <header class="header">
        <h1>Bienvenido, {{ session['usuario'] }}</h1>
        <nav>
            <a href="{{ url_for('clientes.clientes') }}">Clientes</a>
            <a href="{{ url_for('productos.productos') }}">Productos</a>
            <a href="{{ url_for('pedidos.pedidos') }}">Pedidos</a>
            <a href="{{ url_for('auth.confirmar_logout') }}">Cerrar sesión</a>
        </nav>
    </header>

    <h1>Pedidos de {{ session['usuario'] }}</h1>

    <form method="POST">
        <select name="id_cliente" required>
            <option value="">Seleccionar cliente</option>
            {% for cliente in clientes %}
                <option value="{{ cliente.id_cliente }}">{{ cliente.nombre_cliente }}</option>
            {% endfor %}
        </select>
        <input type="date" name="fecha" required>
        <select name="estado">
            <option value="pendiente">Pendiente</option>
            <option value="pagado">Pagado</option>
            <option value="vencido">Vencido</option>
        </select>
        <input type="number" step="0.01" name="monto_total" placeholder="Monto total" required>
        <textarea name="observaciones" placeholder="Observaciones"></textarea>
        <button type="submit">Registrar pedido</button>
    </form>

    <h2>Listado de pedidos</h2>
    <table>
        <tr>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Monto</th>
            <th>Observaciones</th>
            <th>Editar</th>
            <th>Eliminar</th>
        </tr>
        {% for pedido in pedidos %}
        <tr>
            <td>{{ pedido.nombre_cliente }}</td>
            <td>{{ pedido.fecha }}</td>
            <td class="estado {{ pedido.estado }}">{{ pedido.estado }}</td>
            <td>${{ pedido.monto_total }}</td>
            <td>{{ pedido.observaciones }}</td>
            <td><a href="{{ url_for('pedidos.editar_pedido', id=pedido.id_pedido) }}">Editar</a></td>
            <td>
                <form method="POST" action="{{ url_for('pedidos.eliminar_pedido', id=pedido.id_pedido) }}" onsubmit="return confirm('¿Eliminar este pedido?');">
                    <button type="submit" class="btn-eliminar">Eliminar</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    <footer class="footer">
        <p>© 2025 Uriel | Burzaco, Buenos Aires</p>
    </footer>
</body>
</html>